Dúvidas

Possíveis correções/ melhorias:

Objetivo
Automatizar atendimento SDR no Instagram: receber mensagem/comentário, montar contexto, responder com IA e registrar lead.

Webhook1
- Recebe payload do Instagram e inicia o fluxo.

Parametros Fluxo / Dados Lead

- Padroniza variaveis para os demais nodes.
Recebe os seguintes dados:
- IdConversa
- account_id
- sender_id
- recipient_id
- message_text
- from_id
- comment_id

Filtro

- Evita autoreply para mensagens da propria conta

Rotas de Mensagens

- Direcionar cada tipo de entrada para o tratamento correto. Tratando os tipos de mensagem
- Texto1 (conversation)
- Texto2 (reactionMessage)
- Audio (audioMessage)
- Imagem (imageMessage)
- Outro (fallback)

Nodes de convert, e OpenAI
- usado para conversar o conteúdo em pdf, audio, ou foto, e transcrever na openai. Assim é possível enviar o conteúdo para o agent

Bufferizacao
Tipo: Redis + Wait + If
- Agrupar mensagens proximas no tempo e responder com contexto

o que faz: As mensagens que vão chegando são armazenados na primeira memória rediss, é esperado um tempo, esperamos 15 segundos, e se tiver chegado outra mensagem naquele tempo, as mensagens serão agrudadas em uma só.

Apagar Buffer1
- Usado para apagar a mensagem do buffer reddis. Como já temos a mensagem do usuário, não precisamos que ela ocupe o servdiro do redis. Usamos o redis apenas como memória temporária durante as execuções.

Encontrar Cliente1 / Cliente Existe?1 / Criar Cliente1

- Garante persistencia e identificacao do contato no Supabase.
- Busca, se não existe? Cria o cliente
- O merge junta os dados já existes, de conversa com os dados do cliente criado.

Agentes de IA

- NMAI Agent, é quem recebe todas as informações e decide o que fazer com elas.
- OpenAI Chat Model2, gpt-4.1-mini 
- Postgres Chat Memory, memoria por IdConversa 
- Basic LLM Chain, formata output 
- Structured Output Parser, cria uma estrutura para saída do llm Chain

- Gerar resposta contextual, em multiplos blocos curtos, com memoria de conversa.

- Split Out1, quebra array `mensagens` para serrem enviadas em loop com espera para os clientes
- Loop Over Items1
- chat_id, consulta chat
- HTTP Request1, POST envio da mensagem na Unipile, que é api usada para fazer o envio das mensagens no instagram

- https://api23.unipile.com:15389/api/v1/chats/{{chat_id}}/messages






































